parameters:
  - name: yarnInstall
    type: boolean
    default: true
  - name: packageName
    type: string

steps:
  - bash: |
      if [ -z "$PACKAGE_NAME" ]; then
        echo "##vso[task.logissue type=error;]Missing template parameter \"packageName\""
        echo "##vso[task.complete result=Failed;]"
      fi
    env:
      PACKAGE_NAME: ${{ parameters.packageName }}
    displayName: Check for required parameters

  - ${{ if parameters.yarnInstall }}:
      - task: Cache@2
        inputs:
          key: 'yarn | "$(Agent.OS)" | "${{ parameters.packageName }}" | yarn.lock'
          restoreKeys: |
            yarn | "$(Agent.OS)" | "${{ parameters.packageName }}"
          path: ".yarn/cache"
        displayName: Cache Yarn packages

      - bash: yarn workspaces focus ${{ parameters.packageName }}
        displayName: yarn --focus

  - bash: yarn workspace ${{ parameters.packageName }} build
    displayName: yarn build
